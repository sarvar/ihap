<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>modules/ihap_source_player/ihap_youtube.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ihap.html">ihap</a><ul class='methods'><li data-type='method'><a href="ihap.html#appendToPlaylist">appendToPlaylist</a></li><li data-type='method'><a href="ihap.html#changeSong">changeSong</a></li><li data-type='method'><a href="ihap.html#emptyPlaylist">emptyPlaylist</a></li><li data-type='method'><a href="ihap.html#getCurrentSong">getCurrentSong</a></li><li data-type='method'><a href="ihap.html#getCurrentSongIndex">getCurrentSongIndex</a></li><li data-type='method'><a href="ihap.html#getNextSong">getNextSong</a></li><li data-type='method'><a href="ihap.html#getPlaylist">getPlaylist</a></li><li data-type='method'><a href="ihap.html#getPreviousSong">getPreviousSong</a></li><li data-type='method'><a href="ihap.html#pause">pause</a></li><li data-type='method'><a href="ihap.html#play">play</a></li><li data-type='method'><a href="ihap.html#prependToPlaylist">prependToPlaylist</a></li><li data-type='method'><a href="ihap.html#removeFromPlaylist">removeFromPlaylist</a></li><li data-type='method'><a href="ihap.html#setPlaylist">setPlaylist</a></li><li data-type='method'><a href="ihap.html#skip_next">skip_next</a></li><li data-type='method'><a href="ihap.html#skip_prev">skip_prev</a></li></ul></li><li><a href="ihapSettings.html">ihapSettings</a></li><li><a href="module.exports.html">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_resetPlaylist">_resetPlaylist</a></li><li><a href="global.html#_songsPresent">_songsPresent</a></li><li><a href="global.html#_updatePlaylist">_updatePlaylist</a></li><li><a href="global.html#appendSongs">appendSongs</a></li><li><a href="global.html#calculate_progress">calculate_progress</a></li><li><a href="global.html#createMarkup">createMarkup</a></li><li><a href="global.html#dispatchIhapEvent">dispatchIhapEvent</a></li><li><a href="global.html#dispatchPlay">dispatchPlay</a></li><li><a href="global.html#empty">empty</a></li><li><a href="global.html#emptyMeta">emptyMeta</a></li><li><a href="global.html#getNextSong">getNextSong</a></li><li><a href="global.html#getPreviousSong">getPreviousSong</a></li><li><a href="global.html#loadYoutubeApi">loadYoutubeApi</a></li><li><a href="global.html#loadYoutubeVideo">loadYoutubeVideo</a></li><li><a href="global.html#prependSongs">prependSongs</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#setSongs">setSongs</a></li><li><a href="global.html#updateBar">updateBar</a></li><li><a href="global.html#updateMeta">updateMeta</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">modules/ihap_source_player/ihap_youtube.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * module imports
 */
import ihapSourcePlayer from '../ihap_source_player';
import * as YoutubeApiHelper from '../helpers/youtube_api_helper';
import * as ihapEvents from '../helpers/custom_events';

/**
 * ihap youtube module
 * @private
 */
class ihapYoutube extends ihapSourcePlayer {
  /**
   * the youtube module
   * @constructor
   * @private
   */
  constructor(song, progress_bar) {
    super(song, progress_bar);

    this.createMarkup();
    this.setSong(song);
    this.progressInterval = null;
  }

  createMarkup() {
    let youtube_wrapper = document.createElement('div');
    youtube_wrapper.setAttribute('id', 'youtube_wrapper');

    // set properties
    this.markup = youtube_wrapper
  }

  play() {
    console.log('play clicked');
    let self = this;
    if (this.element != null) {
      self.element.playVideo();

      let song_duration = self.element.getDuration();
      if (song_duration == undefined) {
        self.progress_bar.reset(0.0)
      } else {
        self.progress_bar.reset(song_duration)
      }

      // there is no listener for currentTime for youtube, we have to poll
      this.progressInterval = setInterval(function () {
        self.progress_bar.updateBar(self.element.getCurrentTime());
      }, 250);

      let event = new Event('play');
      self.markup.dispatchEvent(event);
    }
  }

  pause() {
    if (this.element != null) {
      this.element.pauseVideo();
    }
  }

  empty() {
  }

  isEmpty() {
  }

  setSong(song) {
    console.log('yt setSong');
    let that = this;
    YoutubeApiHelper.loadYoutubeApi(
      function () {
        that.element = YoutubeApiHelper.loadYoutubeVideo(
          song.container,
          song.getYoutubeId(),
          function (e) {
            that.onYoutubeReady(e)
          },
          function (e) {
            that.onYoutubeStateChange(e)
          },
          function (e) {
            that.onYoutubeError(e)
          }
        )
      }
    );
  }

  unload() {
    this.element.destroy(); // yt api function that removes the iframe and rebuilds the initial dom element
    window.clearInterval(this.progressInterval)
  }

  seekTo(time) {
    this.element.seekTo(time)
  }

  /**
   * Youtube api callbacks
   */

  /**
   * Callback that is passed to the onReady event of the YT api
   * @param event
   */
  onYoutubeReady(event) {
    console.log('YT Video ready: ');
    this.element = event.target
  }

  /**
   * Callback that is passed to the onStateChange event of the YT api
   * @param event
   */
  onYoutubeStateChange(event) {
    console.log('New state: ' + event.data)
  }

  /**
   * Callback that is passed to the onError event of the YT api
   * @param event
   */
  onYoutubeError(event) {
    console.log('Youtube error: ' + event.data)
  }
}

export {ihapYoutube as default}</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a> on Tue Sep 20 2016 13:01:44 GMT+0200 (CEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
